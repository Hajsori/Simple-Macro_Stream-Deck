<!DOCTYPE html>
<html>

<head lang="en">
    <title>Default Simple Macro Options</title>
    <meta charset="utf-8" />
    <script src="./sdpi-components.js"></script>
</head>

<body>
    <!--
        Learn more about property inspector components at https://sdpi-components.dev/docs/components
    -->
    <!-- setting="port" -->
    <sdpi-item label="Port (0-65535) (0 = auto)">
        <sdpi-textfield id="portField" pattern="^([0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$" maxlength="5" default="0"></sdpi-textfield>
        <div id="portError" style="color: red; display: none;">Please enter a valid port (0-65535).</div>
    </sdpi-item>

    <script>
        const portField = document.getElementById("portField");
        const portError = document.getElementById("portError");
        const pattern = new RegExp(portField.getAttribute("pattern"));
        const { streamDeckClient } = SDPIComponents;

        streamDeckClient.getSettings().then(({ settings }) => {
            portField.value = settings.port || "0";

            portField.addEventListener("input", function() {
                if (portField.value === "" || pattern.test(portField.value)) {
                    portError.style.display = "none";
                } else {
                    portError.style.display = "block";
                }

                streamDeckClient.setSettings({ port: parseInt(portField.value) });
            });

            streamDeckClient.setSettings({ port: parseInt(portField.value) });
        })
    </script>
</body>

</html>